# 浅析 URL
　　
### 组成
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                    href                                     │
├──────────┬┬───────────┬─────────────────┬───────────────────────────┬───────┤
│ protocol ││   auth    │      host       │           path            │ hash  │
│          ││           ├──────────┬──────┼──────────┬────────────────┤       │
│          ││           │ hostname │ port │ pathname │     search     │       │
│          ││           │          │      │          ├─┬──────────────┤       │
│          ││           │          │      │          │ │    query     │       │
"  http:   // user:pass @ host.com : 8080   /p/a/t/h  ?  query=string   #hash "
│          ││           │          │      │          │ │              │       │
└──────────┴┴───────────┴──────────┴──────┴──────────┴─┴──────────────┴───────┘
 ```

### 与URI区别

　　URI是Uniform Resource Identifier的缩写，称为统一资源标识符。URI是一个通用的概念，由两个主要的子集URL和URN构成，URL是通过描述资源的位置来标识资源的，而URN则是通过名字来识别资源的，与它们当前所处位置无关

　　URL是Uniform Resource Locator的缩写，称为统一资源定位符。URL正是使用web浏览器等访问web页面时需要输入的网页地址

　　URL是一种强有力的工具。但URL并不完美。它表示的是实际的地址，而不是准确的名字。这种方案的缺点在于如果资源被移走了，URL也就不再有效了。那时，它就无法对对象进行定位了 

　　如果有了对象的准确名称，则不论其位于何处都可以找到这个对象。就像人一样，只要给定了资源的名称和其他一些情况，无论资源移到何处，都能够追踪到它。为了应对这个问题，因特网工程任务组(Internet Engineering Task Force, IETF) 已经对URN的新标准做了一段时间的研究了。无论对象搬移到什么地方，URN都能为对象提供一个稳定的名称

　　但是，从URL转换成URN是一项巨大的工程，支持URN需要进行很多改动——标准主体的一致性，对各种HTTP应用程序的修改等。所以，还要等待更合适的时机才能进行这种转换

 

### URL语法

　　URL语法建立在由下面9部分构成的通用格式上。其中，URL最重要的3个部分是方案(scheme)、主机(host)和路径(path)
```
<scheme>://<user>:<password>@<host>:<port>/<path>:<params>?<query>#<frag>
```
【方案】

　　方案实际上是规定如何访问指定资源的主要标识符，它会告诉负责解析URL的应用程序应该使用什么协议

　　方案组件必须以一个字母符号开始，由第一个“:”符号将其与URL的其余部分分隔开来。方案名是大小写无关的，因此URL“`http://www.hardware.com`”和“`HTTP://www.hardware.com`” 是等价的

【主机和端口】

　　要想在因特网上找到资源，应用程序要知道是哪台机器装载了资源，以及在那台机器的什么地方可以找到能对目标资源进行访问的服务器。URL的主机和端口组件提供了这两组信息

　　主机组件标识了因特网上能够访问资源的宿主机器。可以用上述主机名(`www.hardware.com`)或者IP地址来表示主机名

　　[注意]IP地址可以是192.168.1.1这类IPv4地址名，还可以是[0:0:0:0:0:0:0:1]这样用括号括起来的IPv6地址名

　　比如，下面两个URL就指向同一个资源——第一个URL通过主机名，第二个通过IP地址指向服务器：
```
http://www.hardware.com:80/index.html 
http://161.58.228.45:80/index.html
```
　　端口组件标识了服务器正在监听的网络端口。对下层使用了TCP协议的HTTP来说，默认端口号为80

【用户名和密码】

　　很多服务器都要求输入用户名和密码才会允许用户访问数据。FTP服务器就是这样一个常见的实例
```
ftp://ftp.prep.ai.mit.edu/pub/gnu
ftp://anonymous@ftp.prep.ai.mit.edu/pub/gnu
ftp://anonymous:my_passwd@ftp.prep.ai.mit.edu/pub/gnu 
http://joe:joespasswd@www.joes-hardware.com/sales_info.txt
```
　　第一个例子没有用户或密码组件，只有标准的方案、主机和路径。如果某应用程序使用的URL方案要求输入用户名和密码，比如FTP，但用户没有提供，它通常会插入一个默认的用户名和密码。比如，如果向浏览器提供一个FTP URL，但没有指定用户名和密码，它就会插入anonymous(匿名用户)作为你的用户名，并发送一个默认的密码(IE会发送IEUser)

　　第二个例子显示了一个指定为anonymous的用户名。这个用户名与主机组件组合在一起，看起来就像E-mail地址一样。字符将用户和密码组件与URL的其余部分分隔开来

　　在第三个例子中，指定了用户名(anonymous)和密码(my_passwd)，两者之间由字符“:”分隔

【路径】

　　URL的路径组件说明了资源位于服务器的什么地方。路径通常很像一个分级的文件系统路径
```
http://www.hardware.com:80/seasonal/index-fall.html 
```
　　这个URL中的路径为/seasonal/index-fall.html，很像UNIX文件系统中的文件系统路径。路径是服务器定位资源时所需的信息。可以用字符“/”将HTTP URL的路径组件划分成一些路径段(path segment)，每个路径段都有自己的参数(param)组件

【参数】

　　对很多方案来说，只有简单的主机名和到达对象的路径是不够的。除了服务器正在监听的端口，以及是否能够通过用户名和密码访问资源外，很多协议都还需要更多的信息才能工作

　　负责解析URL的应用程序需要这些协议参数来访问资源。否则，另一端的服务器可能就不会为请求提供服务，或者更糟糕的是，提供错误的服务。比如，像FTP这样的协议，有两种传输模式：二进制和文本形式。肯定不希望以文本形式来传送二进制图片，这样的话，二进制图片可能会变得一团糟

　　为了向应用程序提供它们所需的输入参数，以便正确地与服务器进行交互，URL中有一个参数组件。这个组件就是URL中的名值对列表，由字符“;”将其与URL的其余部分(以及各名值对)分隔开来。它们为应用程序提供了访问资源所需的所有附加信息。比如：
```
ftp://prep.ai.mit.edu/pub/gnu;type=d
```
　　在这个例子中，有一个参数type=d，参数名为type，值为d

　　如前所述，HTTP URL的路径组件可以分成若干路径段。每段都可以有自己的参数。比如：
```
http://www.hardware.com/hammers;sale=false/index.html;graphics=true
```
　　这个例子就有两个路径段，hammers和index.html。hammers路径段有参数sale，其值为false。index.html段有参数graphics，其值为true

【查询字符串】

　　很多资源，比如数据库服务，都是可以通过提问题或进行査询来缩小所请求资源类型范围的。假设数据库中维护着一个未售货物的清单，并可以对淸单进行査询，以判断产品是否有货，那就可以用下列URL来査询Web数据库网关，看看编号为12731、颜色为blue、尺寸为large的条目是否有货：
```
http://www.hardware.com/inventory-check.cgi?item=12731&color=blue&size=large
```
　　这个URL的大部分都与我们见过的其他URL类似。只有问号(?)右边的内容是新出现的。这部分被称为查询(query)组件。URL的査询组件和标识网关资源的URL路径组件一起被发送给网关资源

　　除了有些不合规则的字符需要特别处理之外，对査询组件的格式没什么要求。按照常规，很多网关都希望査询字符串以一系列“名/值”对的形式出现，名值对之间用字符“&”分隔

【片段】

　　有些资源类型，比如HTML，除了资源级之外，还可以做进一步的划分。比如，对一个带有章节的大型文本文档来说，资源的URL会指向整个文本文档，但理想的情况是，能够指定资源中的那些章节

　　为了引用部分资源或资源的一个片段，URL支持使用片段(frag)组件来表示一个资源内部的片段。比如，URL可以指向HTML文档中一个特定的图片或小节

　　片段挂在URL的右手边，最前面有一个字符“#”。比如：
```
http://www.hardware.com/tools.html#drills
```
　　在这个例子中，片段drills引用了Web服务器上页面/tools.html中的一个部分。这部分的名字叫做drills

　　HTTP服务器通常只处理整个对象，而不是对象的片段，客户端不能将片段传送给服务器。浏览器从服务器获得了整个资源之后，会根据片段来显示感兴趣的那部分资源